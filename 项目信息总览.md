# Xhell 项目信息总览

## 一、命令链表（Built-in Commands）

Xhell 内置了以下命令，这些命令在 `builtin_commands.c` 中实现：

### 1. 命令数组定义（第5-9行）
```c
const char *builtins[] = {
    "xpwd", "xcd", "xls", "xtouch", "xecho", "xcat",
    "xcp", "xrm", "xmv", "xhistory", "xtee", "xjournalctl", 
    "xsysinfo", "xhelp", "xcalc", "xsh", "xsearch", "quit"
};
```

### 2. 命令执行映射表（execute_builtin 函数，第20-44行）

| 命令名 | 函数指针 | 功能描述 |
|--------|----------|----------|
| `xpwd` | `cmd_xpwd()` | 显示当前工作目录 |
| `xcd` | `cmd_xcd()` | 切换目录 (支持 `-` 返回上一目录) |
| `xls` | `cmd_xls()` | 列出目录内容 (支持 `-l` 详细模式) |
| `xtouch` | `cmd_xtouch()` | 创建空文件 |
| `xecho` | `cmd_xecho()` | 输出文本到标准输出 |
| `xcat` | `cmd_xcat()` | 查看文件内容 |
| `xcp` | `cmd_xcp()` | 复制文件/目录 (支持 `-r` 递归) |
| `xrm` | `cmd_xrm()` | 删除文件/目录 (支持 `-r` 递归) |
| `xmv` | `cmd_xmv()` | 移动/重命名文件 |
| `xhistory` | `cmd_xhistory()` | 查看命令历史记录 |
| `xtee` | `cmd_xtee()` | 同时写入标准输出和文件 |
| `xjournalctl` | `cmd_xjournalctl()` | 查看 Shell 运行日志 |
| `xsysinfo` | `cmd_xsysinfo()` | 显示系统信息(CPU/内存/内核) |
| `xhelp` | `cmd_xhelp()` | 显示帮助信息 |
| `xcalc` | `cmd_xcalc()` | 简单计算器 (支持 +,-,*,/) |
| `xsh` | `cmd_xsh()` | 执行脚本文件 |
| `xsearch` | `cmd_xsearch()` | 在文件中搜索文本 (类似 grep) |
| `quit` | `cmd_quit()` | 退出 Shell |

### 3. 命令结构（xhell.h 第24-33行）

```c
typedef struct {
    char *args[MAX_ARGS];      // 参数数组
    int argc;                   // 参数个数
    char *input_file;           // 输入重定向文件
    char *output_file;          // 输出重定向文件
    char *error_file;           // 错误输出重定向文件
    int append_output;          // 追加模式标志
    int append_error;           // 错误追加标志
} Command;
```

### 4. 管道链表结构（xhell.h 第35-39行）

```c
typedef struct {
    Command commands[MAX_ARGS]; // 命令数组（支持管道）
    int num_commands;            // 管道中命令的数量
} Pipeline;
```

---

## 二、环境变量表（Environment Variables）

Xhell 使用了以下环境变量：

### 1. 系统环境变量使用

| 环境变量 | 使用位置 | 用途说明 |
|----------|----------|----------|
| `HOME` | `builtin_commands.c:146` | `xcd` 命令无参数时，切换到用户主目录 |
| `PATH` | `external_exec.c:14` | 在外部程序执行时，查找可执行文件路径 |

### 2. 全局变量表（main.c 第3-7行）

```c
char *history[MAX_HISTORY];      // 命令历史数组（最多1000条）
int history_count = 0;           // 历史命令计数
char prev_dir[MAX_PATH_LEN];     // 上一个目录路径（用于 cd -）
char current_dir[MAX_PATH_LEN];  // 当前工作目录路径
```

### 3. 配置常量（xhell.h 第16-22行）

```c
#define MAX_CMD_LEN 1024     // 最大命令长度
#define MAX_ARGS 64          // 最大参数个数
#define MAX_PATH_LEN 512     // 最大路径长度
#define MAX_HISTORY 1000     // 最大历史记录数
#define LOG_FILE ".xhell_log"        // 日志文件路径
#define HISTORY_FILE ".xhell_history" // 历史记录文件路径
```

---

## 三、项目架构总览

```
xhell/
├── include/
│   └── xhell.h              # 头文件（数据结构、函数声明）
├── src/
│   ├── main.c               # 主程序（REPL 循环）
│   ├── builtin_commands.c   # 内置命令实现
│   ├── external_exec.c      # 外部程序执行
│   ├── parser.c             # 命令解析器
│   ├── pipe.c               # 管道处理
│   ├── redirection.c        # I/O 重定向
│   ├── logger.c             # 日志记录
│   └── utils.c              # 工具函数
└── Makefile                 # 编译配置

streamlit_demo/
├── app.py                   # Streamlit Web 界面
├── xhell_wrapper.py         # Python-C 交互接口
└── demo_scenarios.py        # 演示场景配置
```

---

## 四、核心特性

### 1. I/O 重定向
- `>` 覆盖输出重定向
- `>>` 追加输出重定向

### 2. 管道操作
- `|` 命令管道连接
- 支持多级管道

### 3. 外部程序调用
- 支持运行标准 Linux 命令
- 自动在 PATH 中查找可执行文件

### 4. 持久化功能
- 命令历史自动保存到 `.xhell_history`
- 运行日志记录到 `.xhell_log`

---

## 五、启动方式

### 方式1：一键启动脚本
```bash
./start_demo.sh
```

### 方式2：手动启动 Streamlit
```bash
cd /mnt/t2-6tb/Linpeikai/linux/gdut_linux/linuxclass
streamlit run streamlit_demo/app.py
```

### 方式3：直接运行终端
```bash
cd xhell
make
./xhell
```

---

**生成时间**: 2025-12-19 12:04
**项目位置**: /mnt/t2-6tb/Linpeikai/linux/gdut_linux/linuxclass
